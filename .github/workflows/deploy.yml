name: Deploy to cPanel
on:
   push:
      branches: [deploy] # or your default branch

jobs:
   build-and-deploy:
      runs-on: ubuntu-latest

      steps:
         - uses: actions/checkout@v3

         - name: Setup Node.js
           uses: actions/setup-node@v3
           with:
              node-version: '20'
              cache: 'npm'

         - name: Install Dependencies
           run: npm ci

         - name: Build Application
           run: npm run build
           env:
              DATABASE_URL: ${{ secrets.DATABASE_URL }}
              # Add other environment variables your app needs

         - name: Generate Prisma Client
           run: npx prisma generate

         - name: FTP Deploy
           uses: SamKirkland/FTP-Deploy-Action@v4.3.4
           with:
              server: ${{ secrets.FTP_SERVER }}
              username: ${{ secrets.FTP_USERNAME }}
              password: ${{ secrets.FTP_PASSWORD }}
              local-dir: ./.next/
              server-dir: / # Adjust this path according to your cPanel setup
              exclude: |
                 **/.git*
                 **/.git*/**
                 **/node_modules/**
                 README.md
                 .env*
